<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Metadata Visualizer | Indian Recipe Database</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header.original {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .panel-header.translated {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .panel-header.json {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .panel-header.metadata {
            background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
        }

        .panel-body {
            padding: 20px;
        }

        textarea {
            width: 100%;
            height: 250px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .input-row {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .json-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
        }

        .json-key {
            color: #9cdcfe;
        }

        .json-string {
            color: #ce9178;
        }

        .json-number {
            color: #b5cea8;
        }

        .json-boolean {
            color: #569cd6;
        }

        .json-null {
            color: #569cd6;
        }

        .ingredients-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .ingredient-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ingredient-tag .remove {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
        }

        .ingredient-tag .remove:hover {
            opacity: 1;
        }

        .add-ingredient {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .add-ingredient input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-card .icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .stat-card .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .transcript-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 900px) {
            .transcript-comparison {
                grid-template-columns: 1fr;
            }
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .hidden {
            display: none !important;
        }

        .file-upload {
            border: 3px dashed #ccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .file-upload input {
            display: none;
        }

        .file-upload .icon {
            font-size: 3rem;
            color: #ccc;
            margin-bottom: 10px;
        }

        .word-count {
            font-size: 12px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            opacity: 0.9;
        }

        footer a {
            color: white;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }

            .btn,
            .tabs,
            .file-upload {
                display: none;
            }

            .panel {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üçõ Recipe Metadata Visualizer</h1>
            <p>Indian Recipe Database | NPTEL Winter Internship 2025</p>
        </header>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="icon">üìù</div>
                <div class="value" id="originalWordCount">0</div>
                <div class="label">Original Words</div>
            </div>
            <div class="stat-card">
                <div class="icon">üåê</div>
                <div class="value" id="translatedWordCount">0</div>
                <div class="label">Translated Words</div>
            </div>
            <div class="stat-card">
                <div class="icon">ü•ò</div>
                <div class="value" id="ingredientCount">0</div>
                <div class="label">Ingredients</div>
            </div>
            <div class="stat-card">
                <div class="icon">‚úÖ</div>
                <div class="value" id="completionStatus">0%</div>
                <div class="label">Completion</div>
            </div>
        </div>

        <!-- Alert Messages -->
        <div id="alertContainer"></div>

        <!-- Tabs -->
        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="input">üì• Input Data</div>
                <div class="tab" data-tab="preview">üëÅÔ∏è Preview</div>
                <div class="tab" data-tab="json">üìÑ JSON Output</div>
                <div class="tab" data-tab="load">üìÇ Load JSON</div>
            </div>

            <!-- Tab 1: Input Data -->
            <div class="tab-content active" id="tab-input">
                <div class="main-content">
                    <!-- Metadata Panel -->
                    <div class="panel">
                        <div class="panel-header metadata">
                            üìã Video Metadata
                        </div>
                        <div class="panel-body">
                            <div class="input-row">
                                <div class="input-group">
                                    <label>Video ID *</label>
                                    <input type="text" id="videoId" placeholder="e.g., lbhoAJVkWQk">
                                </div>
                                <div class="input-group">
                                    <label>Language *</label>
                                    <select id="language">
                                        <option value="">Select Language</option>
                                        <option value="Hindi">Hindi</option>
                                        <option value="Bengali">Bengali</option>
                                        <option value="Telugu">Telugu</option>
                                        <option value="Tamil">Tamil</option>
                                        <option value="Malayalam">Malayalam</option>
                                        <option value="Marathi">Marathi</option>
                                        <option value="Rajasthani">Rajasthani</option>
                                        <option value="Gujarati">Gujarati</option>
                                        <option value="Punjabi">Punjabi</option>
                                        <option value="Kannada">Kannada</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-group">
                                <label>Video Title *</label>
                                <input type="text" id="videoTitle" placeholder="e.g., Traditional Bengali Fish Curry">
                            </div>

                            <div class="input-group">
                                <label>Channel Name *</label>
                                <input type="text" id="channelName" placeholder="e. g., Rural Recipes BNC">
                            </div>

                            <div class="input-group">
                                <label>Video URL</label>
                                <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=... ">
                            </div>

                            <div class="input-row">
                                <div class="input-group">
                                    <label>Duration</label>
                                    <input type="text" id="duration" placeholder="e.g., 12:45">
                                </div>
                                <div class="input-group">
                                    <label>Publish Date</label>
                                    <input type="date" id="publishDate">
                                </div>
                            </div>

                            <div class="input-row">
                                <div class="input-group">
                                    <label>View Count</label>
                                    <input type="number" id="viewCount" placeholder="e.g., 125000">
                                </div>
                                <div class="input-group">
                                    <label>Like Count</label>
                                    <input type="number" id="likeCount" placeholder="e. g., 5200">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ingredients Panel -->
                    <div class="panel">
                        <div class="panel-header"
                            style="background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);">
                            ü•ó Ingredients
                        </div>
                        <div class="panel-body">
                            <div class="add-ingredient">
                                <input type="text" id="newIngredient"
                                    placeholder="Add ingredient (e.g., Turmeric - 1 tsp)">
                                <button class="btn btn-primary" onclick="addIngredient()">+ Add</button>
                            </div>
                            <div class="ingredients-list" id="ingredientsList">
                                <!-- Ingredients will be added here -->
                            </div>
                            <div style="margin-top: 15px;">
                                <label style="font-weight: 600; color: #333; display: block; margin-bottom: 8px;">Or
                                    paste ingredients (one per line):</label>
                                <textarea id="bulkIngredients" style="height: 120px;"
                                    placeholder="Rohu fish - 500g&#10;Mustard oil - 4 tbsp&#10;Turmeric powder - 1 tsp"></textarea>
                                <button class="btn btn-secondary" onclick="parseBulkIngredients()"
                                    style="margin-top: 10px;">Parse Ingredients</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transcripts -->
                <div class="transcript-comparison">
                    <div class="panel">
                        <div class="panel-header original">
                            üìú Original Transcript (Regional Language)
                        </div>
                        <div class="panel-body">
                            <textarea id="originalTranscript"
                                placeholder="Paste the original transcript from TurboScribe here...&#10;&#10;Example (Bengali):&#10;‡¶Ü‡¶ú ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∞‡¶æ‡¶®‡ßç‡¶®‡¶æ ‡¶ï‡¶∞‡¶¨ ‡¶è‡¶ï‡¶ü‡¶æ traditional ‡¶Æ‡¶æ‡¶õ‡ßá‡¶∞ ‡¶ù‡ßã‡¶≤‡•§&#10;‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Æ‡¶æ‡¶õ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶π‡¶≤‡ßÅ‡¶¶ ‡¶Ü‡¶∞ ‡¶®‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶ñ‡¶ø‡¶Ø‡¶º‡ßá ‡¶®‡¶ø‡¶®‡•§"
                                oninput="updateWordCount()"></textarea>
                            <div class="word-count">Words: <span id="origWordDisplay">0</span></div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header translated">
                            üåê English Translation
                        </div>
                        <div class="panel-body">
                            <textarea id="englishTranscript"
                                placeholder="Paste the English translation from Gemini AI here...&#10;&#10;Example: &#10;Today we will cook a traditional fish curry. &#10;First, clean the fish and marinate with turmeric and salt."
                                oninput="updateWordCount()"></textarea>
                            <div class="word-count">Words: <span id="transWordDisplay">0</span></div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="btn-group" style="justify-content: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="generateJSON()">üìÑ Generate JSON</button>
                    <button class="btn btn-primary" onclick="previewData()">üëÅÔ∏è Preview</button>
                    <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Clear All</button>
                </div>
            </div>

            <!-- Tab 2: Preview -->
            <div class="tab-content" id="tab-preview">
                <div class="panel full-width">
                    <div class="panel-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        üëÅÔ∏è Data Preview
                    </div>
                    <div class="panel-body">
                        <div id="previewContent">
                            <p style="color: #666; text-align: center;">Enter data in the Input tab and click "Preview"
                                to see formatted output.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: JSON Output -->
            <div class="tab-content" id="tab-json">
                <div class="panel full-width">
                    <div class="panel-header json">
                        üìÑ Generated JSON
                        <div>
                            <button class="btn btn-secondary" onclick="copyJSON()"
                                style="padding: 8px 15px; font-size: 12px;">üìã Copy</button>
                            <button class="btn btn-secondary" onclick="downloadJSON()"
                                style="padding: 8px 15px; font-size: 12px; margin-left: 5px;">üíæ Download</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="json-output" id="jsonOutput">
                            {
                            "message": "Enter data in the Input tab and click 'Generate JSON' to see output here."
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Load JSON -->
            <div class="tab-content" id="tab-load">
                <div class="panel full-width">
                    <div class="panel-header" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        üìÇ Load Existing JSON
                    </div>
                    <div class="panel-body">
                        <div class="file-upload" id="dropZone">
                            <div class="icon">üìÅ</div>
                            <p><strong>Drag & Drop JSON file here</strong></p>
                            <p style="color: #666; margin-top: 10px;">or click to browse</p>
                            <input type="file" id="fileInput" accept=".json" onchange="handleFileSelect(event)">
                        </div>

                        <div style="text-align: center; margin:  20px 0; color: #666;">‚Äî OR ‚Äî</div>

                        <div class="input-group">
                            <label>Paste JSON directly:</label>
                            <textarea id="pasteJson" style="height: 200px;"
                                placeholder='Paste your JSON here...&#10;&#10;{&#10;  "video_id": "abc123",&#10;  "title": "Recipe Title",&#10;  ... &#10;}'></textarea>
                        </div>

                        <div class="btn-group" style="justify-content: center;">
                            <button class="btn btn-primary" onclick="loadPastedJSON()">üì• Load JSON</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Built by <strong>Nikhil Raj & Sai Deepika</strong> | NPTEL Winter Internship 2025</p>
            <p>Mentors: Prof. Lipika Dey & Prof. Partha Pratim Das, Ashoka University</p>
        </footer>
    </div>

    <script>
        // Global variables
        let ingredients = [];
        let generatedData = null;

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // File upload drag and drop
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/json') {
                readFile(file);
            } else {
                showAlert('Please drop a valid JSON file. ', 'error');
            }
        });

        // Functions
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                readFile(file);
            }
        }

        function readFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    populateForm(data);
                    showAlert('JSON loaded successfully!', 'success');
                    // Switch to input tab
                    document.querySelector('.tab[data-tab="input"]').click();
                } catch (error) {
                    showAlert('Invalid JSON file:  ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function loadPastedJSON() {
            const jsonText = document.getElementById('pasteJson').value.trim();
            if (!jsonText) {
                showAlert('Please paste JSON data first.', 'error');
                return;
            }
            try {
                const data = JSON.parse(jsonText);
                populateForm(data);
                showAlert('JSON loaded successfully!', 'success');
                document.querySelector('.tab[data-tab="input"]').click();
            } catch (error) {
                showAlert('Invalid JSON: ' + error.message, 'error');
            }
        }

        function populateForm(data) {
            document.getElementById('videoId').value = data.video_id || '';
            document.getElementById('videoTitle').value = data.title || '';
            document.getElementById('channelName').value = data.channel || '';
            document.getElementById('videoUrl').value = data.url || '';
            document.getElementById('language').value = data.language || '';
            document.getElementById('duration').value = data.duration || '';
            document.getElementById('publishDate').value = data.publish_date || '';
            document.getElementById('viewCount').value = data.view_count || '';
            document.getElementById('likeCount').value = data.like_count || '';
            document.getElementById('originalTranscript').value = data.transcript_original || '';
            document.getElementById('englishTranscript').value = data.transcript_english || '';

            // Load ingredients
            ingredients = data.ingredients || [];
            renderIngredients();
            updateWordCount();
            updateStats();
        }

        function addIngredient() {
            const input = document.getElementById('newIngredient');
            const value = input.value.trim();
            if (value && !ingredients.includes(value)) {
                ingredients.push(value);
                renderIngredients();
                input.value = '';
                updateStats();
            }
        }

        // Allow Enter key to add ingredient
        document.getElementById('newIngredient').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addIngredient();
            }
        });

        function removeIngredient(index) {
            ingredients.splice(index, 1);
            renderIngredients();
            updateStats();
        }

        function renderIngredients() {
            const container = document.getElementById('ingredientsList');
            container.innerHTML = ingredients.map((ing, index) => `
                <span class="ingredient-tag">
                    ${escapeHtml(ing)}
                    <span class="remove" onclick="removeIngredient(${index})">√ó</span>
                </span>
            `).join('');
        }

        function parseBulkIngredients() {
            const text = document.getElementById('bulkIngredients').value;
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            lines.forEach(line => {
                if (!ingredients.includes(line)) {
                    ingredients.push(line);
                }
            });
            renderIngredients();
            document.getElementById('bulkIngredients').value = '';
            updateStats();
            showAlert(`Added ${lines.length} ingredients! `, 'success');
        }

        function updateWordCount() {
            const origText = document.getElementById('originalTranscript').value;
            const transText = document.getElementById('englishTranscript').value;

            const origWords = origText.trim() ? origText.trim().split(/\s+/).length : 0;
            const transWords = transText.trim() ? transText.trim().split(/\s+/).length : 0;

            document.getElementById('origWordDisplay').textContent = origWords;
            document.getElementById('transWordDisplay').textContent = transWords;
            document.getElementById('originalWordCount').textContent = origWords;
            document.getElementById('translatedWordCount').textContent = transWords;

            updateStats();
        }

        function updateStats() {
            document.getElementById('ingredientCount').textContent = ingredients.length;

            // Calculate completion percentage
            const fields = [
                document.getElementById('videoId').value,
                document.getElementById('videoTitle').value,
                document.getElementById('channelName').value,
                document.getElementById('language').value,
                document.getElementById('originalTranscript').value,
                document.getElementById('englishTranscript').value
            ];

            const filledFields = fields.filter(f => f.trim()).length;
            const completion = Math.round((filledFields / fields.length) * 100);
            document.getElementById('completionStatus').textContent = completion + '%';
        }

        function generateJSON() {
            const data = collectData();

            if (!data.video_id || !data.title) {
                showAlert('Please fill in at least Video ID and Title.', 'error');
                return;
            }

            generatedData = data;

            const jsonString = JSON.stringify(data, null, 2);
            document.getElementById('jsonOutput').innerHTML = syntaxHighlight(jsonString);

            // Switch to JSON tab
            document.querySelector('.tab[data-tab="json"]').click();
            showAlert('JSON generated successfully!', 'success');
        }

        function collectData() {
            const now = new Date().toISOString().split('T')[0];

            return {
                video_id: document.getElementById('videoId').value.trim(),
                title: document.getElementById('videoTitle').value.trim(),
                channel: document.getElementById('channelName').value.trim(),
                url: document.getElementById('videoUrl').value.trim(),
                language: document.getElementById('language').value,
                duration: document.getElementById('duration').value.trim(),
                publish_date: document.getElementById('publishDate').value,
                view_count: parseInt(document.getElementById('viewCount').value) || null,
                like_count: parseInt(document.getElementById('likeCount').value) || null,
                ingredients: [...ingredients],
                transcript_original: document.getElementById('originalTranscript').value.trim(),
                transcript_english: document.getElementById('englishTranscript').value.trim(),
                metadata: {
                    extraction_date: now,
                    pipeline_version: "1.0",
                    extracted_by: "NPTEL Internship Team"
                }
            };
        }

        function previewData() {
            const data = collectData();

            const previewHtml = `
                <div style="display: grid; gap: 20px;">
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìã Video Information</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px; font-weight: 600; width: 150px;">Video ID: </td>
                                <td style="padding: 10px;">${escapeHtml(data.video_id) || '-'}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px; font-weight: 600;">Title:</td>
                                <td style="padding: 10px;">${escapeHtml(data.title) || '-'}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px; font-weight: 600;">Channel: </td>
                                <td style="padding: 10px;">${escapeHtml(data.channel) || '-'}</td>
                            </tr>
                            <tr style="border-bottom:  1px solid #eee;">
                                <td style="padding: 10px; font-weight: 600;">Language:</td>
                                <td style="padding: 10px;">${escapeHtml(data.language) || '-'}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px; font-weight: 600;">Duration:</td>
                                <td style="padding: 10px;">${escapeHtml(data.duration) || '-'}</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px; font-weight: 600;">Views:</td>
                                <td style="padding: 10px;">${data.view_count ? data.view_count.toLocaleString() : '-'}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div>
                        <h3 style="color: #56ab2f; margin-bottom: 15px;">ü•ó Ingredients (${data.ingredients.length})</h3>
                        <div class="ingredients-list">
                            ${data.ingredients.map(ing => `<span class="ingredient-tag">${escapeHtml(ing)}</span>`).join('')}
                        </div>
                        ${data.ingredients.length === 0 ? '<p style="color: #666;">No ingredients added.</p>' : ''}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap:  20px;">
                        <div>
                            <h3 style="color: #f5576c; margin-bottom:  15px;">üìú Original Transcript</h3>
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                ${escapeHtml(data.transcript_original) || '<em style="color: #999;">No transcript provided.</em>'}
                            </div>
                        </div>
                        <div>
                            <h3 style="color: #4facfe; margin-bottom: 15px;">üåê English Translation</h3>
                            <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                ${escapeHtml(data.transcript_english) || '<em style="color: #999;">No translation provided.</em>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('previewContent').innerHTML = previewHtml;
            document.querySelector('.tab[data-tab="preview"]').click();
        }

        function copyJSON() {
            const data = collectData();
            const jsonString = JSON.stringify(data, null, 2);
            navigator.clipboard.writeText(jsonString).then(() => {
                showAlert('JSON copied to clipboard!', 'success');
            }).catch(() => {
                showAlert('Failed to copy.  Please select and copy manually.', 'error');
            });
        }

        function downloadJSON() {
            const data = collectData();
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `recipe_${data.video_id || 'untitled'}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('JSON file downloaded!', 'success');
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all data?')) {
                document.getElementById('videoId').value = '';
                document.getElementById('videoTitle').value = '';
                document.getElementById('channelName').value = '';
                document.getElementById('videoUrl').value = '';
                document.getElementById('language').value = '';
                document.getElementById('duration').value = '';
                document.getElementById('publishDate').value = '';
                document.getElementById('viewCount').value = '';
                document.getElementById('likeCount').value = '';
                document.getElementById('originalTranscript').value = '';
                document.getElementById('englishTranscript').value = '';
                document.getElementById('bulkIngredients').value = '';
                ingredients = [];
                renderIngredients();
                updateWordCount();
                updateStats();
                showAlert('All data cleared! ', 'info');
            }
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
                <span>${message}</span>
            `;
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        updateStats();
    </script>
</body>

</html>
